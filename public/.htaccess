RewriteEngine On
RewriteBase /

# Serve UVM favicon for all routes (including API URLs opened in browser)
# Force redirect to break caches and bypass any existing /public/favicon.ico
RedirectMatch 302 ^/favicon\.ico$ /images/favicon.png
RedirectMatch 302 ^/api/favicon\.ico$ /images/favicon.png
RedirectMatch 302 ^/health/favicon\.ico$ /images/favicon.png

# Proxy auth endpoints to Node.js backend (specific endpoints only)
RewriteCond %{REQUEST_URI} ^/auth/(login|signup|verify|logout|profile)
RewriteRule ^(.*)$ http://127.0.0.1:3001/$1 [P,L]

# Proxy API requests to Node.js backend (includes /api-keys)
RewriteCond %{REQUEST_URI} ^/(health|api|api-keys)
RewriteRule ^(.*)$ http://127.0.0.1:3001/$1 [P,L]

# Client-side routing for React (handles /auth page for UI)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/(health|api|api-keys)
RewriteCond %{REQUEST_URI} !^/auth/(login|signup|verify|logout|profile)
RewriteRule . /index.html [L]
